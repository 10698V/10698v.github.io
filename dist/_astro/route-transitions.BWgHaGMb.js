import{p}from"./portfolio-loader.-z5lzify.js";import{t as h}from"./spa-router.3jzHxz5n.js";let f=null;function v(e){if(f)return;const o=new Image;o.crossOrigin="anonymous",o.decoding="async",o.loading="eager",o.src=e,o.onload=()=>console.log("[transition] Hero image prewarmed"),f=o}function g(e,o=900){if(!e)return Promise.resolve(null);const c=e.__hero3d;return c?.runBalloonPop?Promise.resolve(c):new Promise(u=>{let a=!1;const s=r=>{a||(a=!0,document.removeEventListener("hero:block-attached",d),document.removeEventListener("hero:block-ready",d),document.removeEventListener("hero:block-disposed",t),clearTimeout(n),u(r))},d=r=>{const i=r?.detail;i?.canvas===e&&i?.api?.runBalloonPop&&s(i.api)},t=r=>{r?.detail?.canvas===e&&s(null)};document.addEventListener("hero:block-attached",d),document.addEventListener("hero:block-ready",d),document.addEventListener("hero:block-disposed",t);const n=window.setTimeout(()=>{s(e.__hero3d??null)},o)})}function w(e,o,c=1200,u="#0a0b11"){const a=()=>{try{window.sessionStorage.setItem("__prim3_from_hero__","1")}catch{}},s=()=>{try{document.body.dataset.enterFromHero="1"}catch{}};if((()=>{p().catch(()=>{})})(),s(),matchMedia("(prefers-reduced-motion: reduce)").matches){a(),h(e,{fromHero:!0}).catch(()=>{window.location.href=e});return}try{const i=document.createElement("link");i.rel="prefetch",i.href=e,document.head.appendChild(i),fetch(e,{credentials:"same-origin"}).catch(()=>{})}catch{}const n=document.getElementById(o),r=n?.closest("section");g(n).then(i=>{if(i&&(i.setCameraLocked&&i.setCameraLocked(!0),r)){Object.assign(r.style,{position:"fixed",inset:"0",width:"100vw",height:"100vh",zIndex:"9999",margin:"0",padding:"0",borderRadius:"0",transform:"none",background:"transparent"});const l=r.querySelector(".hero-stage");l&&Object.assign(l.style,{height:"100vh",width:"100vw",maxHeight:"none"});const m=r.querySelector(".hero-reflection");m&&(m.style.display="none"),n&&(n.id="hero-transition-canvas",document.body.appendChild(n),window.__persistedHeroCanvas=n,Object.assign(n.style,{position:"fixed",inset:"0",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",zIndex:"50",pointerEvents:"none"}),window.dispatchEvent(new Event("resize")),requestAnimationFrame(()=>{window.dispatchEvent(new Event("resize"))}))}a(),setTimeout(()=>{h(e,{fromHero:!0}).catch(()=>{window.location.href=e})},100)})}function E(e){if(typeof window>"u"||typeof document>"u")return;const{linkSelector:o,sourceCanvasId:c,duration:u=1200,bg:a="#0a0b11"}=e,s=Array.from(document.querySelectorAll(o));if(!s.length)return;const d=t=>{const n=t.currentTarget;if(!n||t.defaultPrevented||t.button!==0||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)return;t.preventDefault();const r=n.getAttribute("href")||"/";w(r,c,u,a)};s.forEach(t=>{t.dataset.heroTransitionBound!=="1"&&(t.dataset.heroTransitionBound="1",t.addEventListener("click",d))})}document.addEventListener("astro:after-swap",()=>{const e=window.__persistedHeroCanvas;e&&!document.body.contains(e)&&(console.log("[Route] Restoring persisted hero canvas"),document.body.appendChild(e))});export{v as prewarmHeroMask,E as setupHeroToTeamTransition,w as triggerHeroTransition};
