const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/hero-block.CQHbB6ve.js","_astro/spa-router.3jzHxz5n.js","_astro/UnrealBloomPass.D6T5-zMz.js"])))=>i.map(i=>d[i]);
import{t as h,_ as g}from"./spa-router.3jzHxz5n.js";import{disposeRogerTiles as P,bootRogerTiles as I}from"./roger-tiles.D74qxO8g.js";import{initRoleBacks as B,cleanupRoleBacks as k}from"./role-back.DxKcLhxM.js";const C="[team]";let R=null,T=null,_=!1;function j(e=typeof window<"u"?window.location.pathname:""){return e==="/team"||e==="/team/"||e==="/team/index.html"}const w=()=>typeof window<"u"&&typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion: reduce)").matches;async function b(){return T||(T=Promise.all([g(()=>import("https://esm.sh/gsap@3.12.5"),[]),g(()=>import("https://esm.sh/gsap@3.12.5/ScrollTrigger?external=gsap"),[])]).then(([e,t])=>{const n=e.gsap??e.default??e,a=t.ScrollTrigger??t.default??t;return n.registerPlugin(a),{gsap:n,ScrollTrigger:a}})),T}function H(e){let t=!!e?.fromHero;try{window.sessionStorage.getItem("__prim3_from_hero__")==="1"&&(t=!0,window.sessionStorage.removeItem("__prim3_from_hero__"))}catch{}return t}let p=!1;function q(e){if(console.log("[Team] runSummonIntro called, fromHero:",e,"running:",p),p){console.log("[Team] runSummonIntro already running, skipping duplicate call");return}p=!0;const t=document.querySelector(".team-page"),n=document.querySelector(".team-header");if(!t){p=!1;return}const a=w(),d=()=>{delete document.body.dataset.enterFromHero,t.style.opacity="1",t.style.transform="",p=!1};if(setTimeout(()=>{d()},4e3),a){d();return}t.dataset.summonInit="1",b().then(({gsap:i})=>{console.log("[Team] GSAP loaded");const o=t.querySelectorAll(".tile"),s=t.querySelector(".team-grid");if(t.style.opacity="1",e&&o.length)console.log("[Team] Starting Reassembly Sequence"),n&&i.fromTo(n,{y:-30,opacity:0},{y:0,opacity:1,duration:.8,ease:"power3.out",delay:.2}),console.log("[Team] Importing hero-block..."),g(()=>import("./hero-block.CQHbB6ve.js"),__vite__mapDeps([0,1,2])).then(async({bootHero:r,disposeHero:l})=>{console.log("[Team] hero-block imported successfully"),g(()=>import("./team-reassembly.BwQuPz_0.js"),[]).then(async({getTeamCardRects:m})=>{console.log("[Team] Modules loaded");const v=document.getElementById("hero-transition-canvas")||window.__persistedHeroCanvas;let c,y=!1;v?(console.log("[Team] Adopting existing hero canvas"),c=v,y=!0,c.id=""):(l&&l(),c=document.createElement("canvas"),document.body.appendChild(c)),Object.assign(c.style,{position:"fixed",inset:"0",width:"100%",height:"100%",zIndex:"50",pointerEvents:"none",backgroundColor:"transparent",mixBlendMode:"screen",filter:"saturate(1.15) brightness(1.12)"});const A=new Promise(u=>{if(y&&c.__hero3d){u(c.__hero3d);return}const L=S=>{S.detail.canvas===c&&(document.removeEventListener("hero:block-ready",L),u(S.detail.api))};document.addEventListener("hero:block-ready",L)});console.log("[Team] Booting Hero on canvas (adopting:",y,")");try{r({canvas:c,startExploded:!0})}catch(u){throw console.error("[Team] bootHero failed:",u),u}const f=await A;console.log("[Team] Hero API ready"),i.set(t,{opacity:1}),s&&i.set(s,{opacity:1});const E=m();if(console.log("[Team] Calculated rects:",E.length),f.setReassemblyTargets&&f.runToCards){console.log("[Team] Running unified animation"),await f.runToCards({targetRects:E,duration:1.8}),console.log("[Team] Running morph effect");const u=f.runMorph?f.runMorph(.6):Promise.resolve();i.delayedCall(.35,()=>{console.log("[Team] Handoff to DOM"),document.documentElement.classList.remove("hero-transition"),i.fromTo(o,{opacity:0,scale:1.1,filter:"brightness(1.5)"},{opacity:1,scale:1,filter:"brightness(1)",duration:.5,ease:"power2.out"})}),await u,i.to(c,{opacity:0,duration:.3,onComplete:()=>{c.remove(),l&&l()}})}else console.warn("[Team] API missing setReassemblyTargets"),i.to(o,{opacity:1,duration:.5}),c.remove()})}).catch(r=>{console.error("[Team] Failed to import hero-block:",r),i.to(o,{opacity:1,duration:.5})});else{console.log("[Team] Standard Entrance");const r=i.timeline({defaults:{ease:"power2.out"},onComplete:d});r.to(t,{opacity:1,duration:.55,ease:"power2.out"},.1),n&&r.fromTo(n,{y:-30,opacity:0},{y:0,opacity:1,duration:.8,ease:"power3.out"},.2),o.length&&r.fromTo(o,{y:40,opacity:0},{y:0,opacity:1,duration:.8,stagger:.1},"-=0.4")}}).catch(i=>{console.error("[Team] GSAP load failed",i),d()})}function D(){let e=null,t=!1;const n=Array.from(document.querySelectorAll(".tile")),a=o=>{o.dispatchEvent(new CustomEvent("tile:flipped",{detail:{flipped:o.classList.contains("is-flipped")}}))},d=(o,s)=>{o.classList.toggle("is-flipped",s),o.setAttribute("aria-pressed",s?"true":"false"),a(o)},i=()=>{const o=n.filter(s=>s.classList.contains("is-flipped"));if(!o.length){e=null;return}e=o[0]??null;for(let s=1;s<o.length;s+=1)d(o[s],!1)};i(),n.forEach(o=>{if(o.dataset.flipBound==="1")return;o.dataset.flipBound="1";const s=r=>{if(t)return;t=!0;const l=()=>{window.setTimeout(()=>{t=!1},140)};try{const m=typeof r=="boolean"?r:!o.classList.contains("is-flipped");m&&e&&e!==o&&(d(e,!1),e=null),d(o,m),e=m?o:null,i()}finally{l()}};o.addEventListener("click",r=>{const l=r.target instanceof HTMLElement?r.target:null;l&&l.closest(".tile-true-btn")||s()}),o.addEventListener("keydown",r=>{const l=r.target instanceof HTMLElement?r.target:null;l&&l.closest(".tile-true-btn")||(r.key==="Escape"&&(r.preventDefault(),s(!1)),(r.key==="Enter"||r.key===" ")&&l===o&&(r.preventDefault(),s()))}),o.setAttribute("aria-pressed",o.classList.contains("is-flipped")?"true":"false"),a(o)})}function x(){document.querySelectorAll(".tile").forEach(e=>{if(e.dataset.burstBound==="1")return;e.dataset.burstBound="1";const t=e.querySelector(".tile-burst");t&&e.addEventListener("click",n=>{e.classList.contains("is-flipped")||(t.classList.remove("is-active"),t.offsetWidth,t.classList.add("is-active"),setTimeout(()=>t.classList.remove("is-active"),500))})})}function F(){const e=document.querySelector(".go-home-btn");!e||e.dataset.dustBound==="1"||(e.dataset.dustBound="1",e.addEventListener("click",t=>{if(w())return;t.preventDefault();const n=e.getAttribute("href")||"/";try{window.sessionStorage.setItem("__prim3_from_team__","1")}catch{}b().then(({gsap:a})=>{const d=a.utils.toArray(".tile"),i=a.timeline({defaults:{ease:"power2.in",duration:.5},onComplete:()=>{h(n,{fromHero:!1,fromTeam:!0}).catch(()=>{window.location.href=n})}});d.length?i.to(d,{opacity:0,scale:.85,rotateY:10,filter:"blur(6px)",stagger:{each:.04,from:"random"}},0):i.add(()=>{h(n,{fromHero:!1,fromTeam:!0}).catch(()=>{window.location.href=n})})}).catch(()=>{h(n,{fromHero:!1,fromTeam:!0}).catch(()=>{window.location.href=n})})}))}async function M(){if(w())return;const{gsap:e}=await b();e.utils.toArray(".team-card").forEach((n,a)=>{n.dataset.teamRevealBound!=="1"&&(n.dataset.teamRevealBound="1",e.from(n,{scrollTrigger:{trigger:n,start:"top 85%",once:!0},opacity:0,y:24,duration:.6,ease:"power2.out",delay:a*.06,immediateRender:!1}))})}function G(e){e&&e.dataset.ripplesBooted!=="1"&&(e.dataset.ripplesBooted="1",window.__PRIM3_RIPPLE_DPR=.9,I(),console.log(`${C} WebGL tiles booted`))}function O(){_||(_=!0,P(),k())}function N(e){if(typeof window>"u"||typeof document>"u")return;const t=document.querySelector(".team-page");if(t?.dataset.summonInit==="1"){console.log("[Team] initTeamPage called but already initializing, skipping");return}_=!1,document.addEventListener("astro:before-swap",O,{once:!0});const n=H(e),a=document.querySelector(".team-grid");t&&(delete t.dataset.summonPending,t.dataset.summonInit="1"),a!==R&&(a&&(a.dataset.ripplesBooted="0"),R=a),D(),x(),F(),G(a),M(),B(),q(n)}export{O as cleanupTeamPage,N as initTeamPage,j as isTeamRoute};
