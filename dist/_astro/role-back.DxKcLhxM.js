const xe="アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン",be="PID ODOM IMU mm° rpm Ψ Ω Σ Λ Ξ",Se="0123456789",Wt=xe+Se+be,ve=18,At=50,$t=180,Gt=1.5,Lt=6e3,Ht=14e3,Vt=()=>Wt[Math.floor(Math.random()*Wt.length)],we=r=>{const c=document.createElement("canvas");c.className="matrix-rain-canvas",Object.assign(c.style,{position:"absolute",inset:"0",width:"100%",height:"100%"});const e=c.getContext("2d");if(!e)return()=>{};r.appendChild(c);let t=0,o=0,d=Math.min(window.devicePixelRatio||1,Gt),L=[],_=0,q=0,T=!0,p=0,x=0,A=Lt+Math.random()*(Ht-Lt);const N=()=>Math.max(11,Math.min(16,t/28)),O=()=>{const G=Math.max(6,Math.floor(t/ve)),C=t/G;L=Array.from({length:G},(b,y)=>{const l=8+Math.floor(Math.random()*18);return{x:y*C+C*.5,y:-Math.random()*o,speed:At+Math.random()*($t-At),tailLen:l,chars:Array.from({length:l},()=>Vt()),charTimer:Math.random()*.5}})},Y=()=>{t=r.clientWidth||1,o=r.clientHeight||1,d=Math.min(window.devicePixelRatio||1,Gt),c.width=Math.round(t*d),c.height=Math.round(o*d),e.setTransform(d,0,0,d,0,0),e.textAlign="center",e.textBaseline="top",O()},tt=G=>{e.fillStyle="rgba(0, 0, 0, 0.08)",e.fillRect(0,0,t,o);const C=N();if(e.font=`${C}px "VT323", "JetBrains Mono", monospace`,L.forEach(b=>{if(b.y+=b.speed*G,b.charTimer-=G,b.charTimer<=0){b.charTimer=.1+Math.random()*.4;const y=Math.floor(Math.random()*b.chars.length);b.chars[y]=Vt()}b.y-b.tailLen*C>o&&(b.y=-C*2,b.speed=At+Math.random()*($t-At));for(let y=0;y<b.tailLen;y++){const l=b.y-(b.tailLen-1-y)*C;if(l<-C||l>o+C)continue;const F=y/(b.tailLen-1),H=F*F*.9;y===b.tailLen-1?(e.fillStyle="rgba(220, 255, 230, 1)",e.shadowColor="rgba(180, 255, 200, 0.9)",e.shadowBlur=12):(e.fillStyle=`rgba(0, 255, 70, ${H})`,e.shadowColor=`rgba(0, 200, 80, ${H*.5})`,e.shadowBlur=H>.3?6:2),e.fillText(b.chars[y],b.x,l)}e.shadowBlur=0}),x>0){const b=(1-x)*o;e.fillStyle=`rgba(0, 255, 100, ${x*.15})`,e.fillRect(0,b-3,t,6),e.globalCompositeOperation="screen",e.fillStyle=`rgba(255, 0, 100, ${x*.08})`,e.fillRect(0,b-1,t,2),e.globalCompositeOperation="source-over"}},j=G=>{if(!T)return;q||(q=G);const C=Math.min((G-q)/1e3,.05);q=G,p+=C*1e3,p>A&&(p=0,A=Lt+Math.random()*(Ht-Lt),x=1),x=Math.max(0,x-C*8),tt(C),_=requestAnimationFrame(j)},I=new ResizeObserver(()=>Y());return I.observe(r),Y(),e.fillStyle="rgba(0, 0, 0, 1)",e.fillRect(0,0,t,o),_=requestAnimationFrame(j),()=>{T=!1,cancelAnimationFrame(_),I.disconnect(),c.remove()}},zt=1.5,Pe=1e3/30,_t=.58,Xt=.92,Ut=.34,jt=.54,ke=.82,Kt=.45,Zt=.72,Jt=10,Qt=14,vt=82,te=120,Ae=[{label:"C-CHANNEL",kind:"c_channel",targetX:.34,targetY:.5,w:.28,h:.055},{label:"GUSSET",kind:"gusset",targetX:.48,targetY:.38,w:.1,h:.09},{label:"BEARING",kind:"bearing",targetX:.58,targetY:.43,w:.085,h:.085},{label:"SHAFT",kind:"shaft",targetX:.53,targetY:.58,w:.23,h:.028},{label:"GEAR",kind:"gear",targetX:.66,targetY:.52,w:.11,h:.11},{label:"SPROCKET",kind:"sprocket",targetX:.73,targetY:.4,w:.1,h:.1},{label:"OMNI WHEEL",kind:"omni_wheel",targetX:.27,targetY:.66,w:.14,h:.14},{label:"PISTON",kind:"piston",targetX:.78,targetY:.62,w:.06,h:.18},{label:"MOTOR",kind:"motor",targetX:.41,targetY:.64,w:.14,h:.11},{label:"FRAME RAIL",kind:"frame_rail",targetX:.58,targetY:.66,w:.3,h:.052},{label:"STANDOFF",kind:"standoff",targetX:.62,targetY:.34,w:.052,h:.112},{label:"AXLE COLLAR",kind:"axle_collar",targetX:.71,targetY:.59,w:.08,h:.08}],U=(r,c)=>r+Math.random()*(c-r),mt=(r,c,e)=>Math.max(c,Math.min(e,r)),Nt=r=>{const c=mt(r,0,1);return c*c*(3-2*c)},ee=r=>{const c=mt(r,0,1),e=.35;return 1+(e+1)*Math.pow(c-1,3)+e*Math.pow(c-1,2)},Yt=r=>{const c=[...r];for(let e=c.length-1;e>0;e-=1){const t=Math.floor(Math.random()*(e+1)),o=c[e];c[e]=c[t],c[t]=o}return c},Le=(r,c={})=>{const e=document.createElement("canvas");e.className="builder-forge-canvas",Object.assign(e.style,{position:"absolute",inset:"0",width:"100%",height:"100%",pointerEvents:"none"});const t=e.getContext("2d");if(!t)return()=>{};r.appendChild(e);let o=1,d=1,L=Math.min(window.devicePixelRatio||1,zt),_=!0,q=0,T=0,p=0,x="summon",A=0,N=U(Kt,Zt),O=0,Y=U(_t,Xt),tt=U(Jt,Qt),j=0,I=vt,G=0,C=[],b=0,y=new Map,l=[];const F=[],H=[],E={active:!1,text:"INSPECTED // PASS",time:0,slamDur:.17,fadeDur:.56},D={active:!1,time:0,duration:.8,originX:.78,originY:.62,emittedBurst:!1},gt=(i,m)=>({x:i*o,y:m*d}),pt=i=>i/Math.max(1,o),ut=i=>i/Math.max(1,d),X=()=>{o=Math.max(1,r.clientWidth),d=Math.max(1,r.clientHeight),L=Math.min(window.devicePixelRatio||1,zt),e.width=Math.round(o*L),e.height=Math.round(d*L),t.setTransform(L,0,0,L,0,0),it()},S=(i,m,f,u,s,B=.8)=>{const z=gt(i,m);F.push({x:z.x,y:z.y,life:f/1e3,maxLife:f/1e3,r0:u,r1:s,alpha:B})},w=(i,m,f,u)=>{const s=gt(i,m),B=Math.floor(U(f,u+1)),z=mt(B,1,16);for(let et=0;et<z;et+=1){const P=U(0,Math.PI*2),R=U(38,108);H.push({x:s.x,y:s.y,vx:Math.cos(P)*R,vy:Math.sin(P)*R,life:U(.22,.32),maxLife:.32,size:U(1.1,2.3)})}},Z=i=>{E.active=!0,E.text=Math.random()<.5?"INSPECTED // PASS":"TORQUE VERIFIED",E.time=0,E.slamDur=U(.14,.2),E.fadeDur=U(.4,.7),w(.5,.5,10,16)},dt=()=>{const i=y.get("PISTON");D.active=!0,D.time=0,D.duration=U(.7,.9),D.originX=i?.targetX??.78,D.originY=i?.targetY??.62,D.emittedBurst=!1},n=()=>"rgba(7, 36, 66, 0.9)",g=()=>"rgba(110, 237, 255, 0.92)",v=(i,m,f,u,s)=>{t.beginPath(),t.arc(i,m,f,0,Math.PI*2),t.fillStyle=u,t.fill(),s&&(t.strokeStyle=s,t.lineWidth=1.2,t.stroke())},a=i=>{if(!i.active)return;const m=i.x*o,f=i.y*d,u=i.w*o,s=i.h*d,B=i.status==="exploded"?Math.sin(i.phase)*1.6:0,z=m+B,et=f;if(t.save(),t.translate(z,et),i.kind==="shaft"&&t.rotate(.12),i.kind==="c_channel")t.fillStyle=n(),t.strokeStyle=g(),t.lineWidth=1.2,t.fillRect(-u/2,-s/2,u,s),t.strokeRect(-u/2,-s/2,u,s),t.strokeRect(-u/2+3,-s/2+2,u-6,s-4);else if(i.kind==="gusset")t.beginPath(),t.moveTo(-u/2,s/2),t.lineTo(u/2,s/2),t.lineTo(-u/2,-s/2),t.closePath(),t.fillStyle=n(),t.fill(),t.strokeStyle=g(),t.lineWidth=1.2,t.stroke();else if(i.kind==="bearing")v(0,0,Math.min(u,s)*.45,"rgba(11, 44, 80, 0.92)",g()),v(0,0,Math.min(u,s)*.2,"rgba(2, 12, 25, 0.92)","rgba(124, 238, 255, 0.78)");else if(i.kind==="shaft")t.fillStyle="rgba(16, 62, 108, 0.9)",t.fillRect(-u/2,-s/2,u,s),t.strokeStyle=g(),t.lineWidth=1.2,t.strokeRect(-u/2,-s/2,u,s);else if(i.kind==="gear"||i.kind==="sprocket"){const P=Math.min(u,s)*.45,R=i.kind==="gear"?10:12;t.beginPath();for(let W=0;W<=R*2;W+=1){const at=W/(R*2)*Math.PI*2,ht=W%2===0?P:P*.82,Mt=Math.cos(at)*ht,kt=Math.sin(at)*ht;W===0?t.moveTo(Mt,kt):t.lineTo(Mt,kt)}t.closePath(),t.fillStyle="rgba(12, 44, 80, 0.9)",t.fill(),t.strokeStyle=g(),t.lineWidth=1.2,t.stroke(),v(0,0,P*.34,"rgba(1, 10, 20, 0.94)","rgba(122, 232, 255, 0.8)")}else if(i.kind==="omni_wheel"){const P=Math.min(u,s)*.45;v(0,0,P,"rgba(14, 48, 92, 0.9)",g());for(let R=0;R<8;R+=1){const W=R/8*Math.PI*2,at=Math.cos(W)*P*.75,ht=Math.sin(W)*P*.75;t.beginPath(),t.ellipse(at,ht,P*.16,P*.08,W,0,Math.PI*2),t.fillStyle="rgba(108, 225, 255, 0.55)",t.fill()}v(0,0,P*.28,"rgba(2, 12, 24, 0.94)")}else if(i.kind==="piston"){const P=D.active?(()=>{const Mt=mt(D.time/D.duration,0,1);return Mt<.5?Nt(Mt/.5):1-Nt((Mt-.5)/.5)})():0,R=u*.52,W=s*.58,at=u*.16,ht=s*(.38+P*.46);t.fillStyle="rgba(9, 38, 70, 0.92)",t.fillRect(-R/2,-W/2,R,W),t.strokeStyle=g(),t.lineWidth=1.2,t.strokeRect(-R/2,-W/2,R,W),t.fillStyle="rgba(128, 230, 255, 0.85)",t.fillRect(-at/2,-W/2-ht,at,ht)}else if(i.kind==="motor"){const P=u*.76,R=s*.72;t.fillStyle="rgba(10, 40, 74, 0.94)",t.fillRect(-P/2,-R/2,P,R),t.strokeStyle=g(),t.lineWidth=1.2,t.strokeRect(-P/2,-R/2,P,R),t.fillStyle="rgba(121, 232, 255, 0.8)",t.fillRect(P*.24,-R*.18,P*.26,R*.36),t.strokeStyle="rgba(92, 210, 255, 0.85)",t.strokeRect(P*.24,-R*.18,P*.26,R*.36)}else if(i.kind==="frame_rail"){t.fillStyle="rgba(8, 32, 62, 0.92)",t.fillRect(-u/2,-s/2,u,s),t.strokeStyle=g(),t.lineWidth=1.2,t.strokeRect(-u/2,-s/2,u,s);for(let P=-2;P<=2;P+=1)v(P/2*(u*.36),0,Math.max(1.2,s*.22),"rgba(3, 14, 28, 0.95)","rgba(116, 233, 255, 0.55)")}else if(i.kind==="standoff"){const P=Math.min(u,s)*.38;t.beginPath();for(let R=0;R<6;R+=1){const W=R/6*Math.PI*2+Math.PI/6,at=Math.cos(W)*P,ht=Math.sin(W)*(s*.44);R===0?t.moveTo(at,ht):t.lineTo(at,ht)}t.closePath(),t.fillStyle="rgba(10, 43, 78, 0.94)",t.fill(),t.strokeStyle=g(),t.lineWidth=1.1,t.stroke(),v(0,0,Math.max(1.4,P*.22),"rgba(2, 12, 24, 0.96)")}else if(i.kind==="axle_collar"){const P=Math.min(u,s)*.42;v(0,0,P,"rgba(10, 40, 74, 0.92)",g()),v(0,0,P*.38,"rgba(2, 12, 24, 0.98)","rgba(128, 236, 255, 0.78)"),t.strokeStyle="rgba(120, 232, 255, 0.65)",t.lineWidth=1,t.beginPath(),t.moveTo(P*.2,-P*.78),t.lineTo(P*.68,-P*.26),t.stroke()}i.status==="locked"&&(t.strokeStyle="rgba(89, 240, 255, 0.46)",t.lineWidth=1,t.strokeRect(-u/2-1,-s/2-1,u+2,s+2)),t.restore()},h=()=>{const i=o*.52,m=d*.54,f=o*.44,u=d*.22,s=Math.max(6,d*.018);t.strokeStyle="rgba(84, 224, 255, 0.33)",t.fillStyle="rgba(15, 56, 95, 0.14)",t.lineWidth=1.15,t.setLineDash([4,4]),t.strokeRect(i-f/2,m-u/2-s/2,f,s),t.strokeRect(i-f/2,m+u/2-s/2,f,s),t.fillRect(i-f/2,m-u/2-s/2,f,s),t.fillRect(i-f/2,m+u/2-s/2,f,s),t.setLineDash([]);for(let B=-1;B<=1;B+=1){const z=i+B*(f*.26);t.beginPath(),t.moveTo(z,m-u/2),t.lineTo(z,m+u/2),t.stroke()}},M=()=>{const i=Math.max(72,o*.2),m=Math.max(34,d*.12),f=o-i-10,u=10,s=mt((I-vt)/(te-vt),0,1);t.fillStyle="rgba(3, 16, 34, 0.8)",t.fillRect(f,u,i,m),t.strokeStyle="rgba(111, 236, 255, 0.72)",t.lineWidth=1,t.strokeRect(f,u,i,m),t.fillStyle="rgba(138, 239, 255, 0.75)",t.font=`${Math.max(7,o/64)}px "Press Start 2P", monospace`,t.textAlign="left",t.fillText("PSI",f+6,u+11);const B=f+6,z=u+m-12,et=i-12,P=6;t.fillStyle="rgba(18, 47, 82, 0.95)",t.fillRect(B,z,et,P),t.fillStyle="rgba(66, 230, 255, 0.92)",t.fillRect(B,z,et*s,P),t.strokeStyle="rgba(130, 239, 255, 0.9)",t.strokeRect(B,z,et,P),t.textAlign="right",t.fillStyle="rgba(160, 246, 255, 0.9)",t.fillText(`${Math.round(I)}`,f+i-6,u+11)},$=i=>{for(let m=F.length-1;m>=0;m-=1){const f=F[m];if(f.life-=i,f.life<=0){F.splice(m,1);continue}const u=1-f.life/f.maxLife,s=f.r0+(f.r1-f.r0)*Nt(u),B=f.alpha*(1-u);t.beginPath(),t.arc(f.x,f.y,s,0,Math.PI*2),t.strokeStyle=`rgba(124, 239, 255, ${B})`,t.lineWidth=1.2,t.stroke()}for(let m=H.length-1;m>=0;m-=1){const f=H[m];if(f.life-=i,f.life<=0){H.splice(m,1);continue}f.x+=f.vx*i,f.y+=f.vy*i,f.vx*=.9,f.vy*=.9;const u=mt(f.life/f.maxLife,0,1),s=f.size*(.8+.4*u);t.fillStyle=`rgba(116, 240, 255, ${u})`,t.fillRect(f.x-s*.5,f.y-s*.5,s,s)}},J=i=>{if(!E.active)return;E.time+=i;const m=E.slamDur+E.fadeDur;if(E.time>=m){E.active=!1;return}const f=E.time<E.slamDur,u=f?ee(E.time/E.slamDur):1,s=f?0:mt((E.time-E.slamDur)/E.fadeDur,0,1),B=f?1:1-s,z=f?(1-E.time/E.slamDur)*2.2:0,et=o*.5+Math.sin(E.time*80)*z,P=d*.21+Math.cos(E.time*95)*z,R=Math.max(100,o*.45)*(.82+.18*u),W=Math.max(20,d*.12)*(.82+.18*u);t.save(),t.translate(et,P),t.scale(u,u),t.fillStyle=`rgba(6, 18, 40, ${.78*B})`,t.strokeStyle=`rgba(142, 243, 255, ${.9*B})`,t.lineWidth=1.3,t.fillRect(-R/2,-W/2,R,W),t.strokeRect(-R/2,-W/2,R,W),t.textAlign="center",t.fillStyle=`rgba(167, 249, 255, ${B})`,t.font=`${Math.max(8,o/56)}px "Press Start 2P", monospace`,t.fillText(E.text,0,3),t.restore()},rt=()=>{if(x!=="summon")return;const i=mt(A/N,0,1),m=-d*.15+i*d*1.3,f=t.createLinearGradient(0,m-30,0,m+30);f.addColorStop(0,"rgba(106, 241, 255, 0)"),f.addColorStop(.5,"rgba(106, 241, 255, 0.28)"),f.addColorStop(1,"rgba(106, 241, 255, 0)"),t.fillStyle=f,t.fillRect(0,m-30,o,60)},it=()=>{y.clear(),l=Ae.map(s=>({...s,active:!0,status:"exploded",x:s.targetX,y:s.targetY,phase:Math.random()*Math.PI*2,snapFromX:s.targetX,snapFromY:s.targetY,snapElapsed:0,snapDur:.66,overshootPx:U(1,2)}));for(const s of l)y.set(s.label,s);const i=Math.floor(U(10,13)),m=new Set(Yt(l.map(s=>s.label)).slice(0,i)),f=Yt(l.filter(s=>m.has(s.label))),u=f.length||1;f.forEach((s,B)=>{const z=B/u*Math.PI*2+U(-.25,.25),et=U(.33,.44);s.x=.52+Math.cos(z)*et,s.y=.52+Math.sin(z)*et*.72,s.active=!0,s.status="exploded",s.phase=Math.random()*Math.PI*2,s.snapFromX=s.x,s.snapFromY=s.y,s.snapElapsed=0,s.snapDur=U(Ut,jt),s.overshootPx=U(1,2)}),l.forEach(s=>{m.has(s.label)||(s.active=!1)}),C=Yt(Array.from(m)),b=0,G=0,A=0,N=U(Kt,Zt),Y=U(_t,Xt),O=0,x="summon",F.length=0,H.length=0,D.active=!1,I=vt+U(-2,3),c.onPsi?.(I)},V=i=>{const m=y.get(i);!m||!m.active||m.status!=="exploded"||(m.status="snapping",m.snapFromX=m.x,m.snapFromY=m.y,m.snapElapsed=0,m.snapDur=U(Ut,jt),m.overshootPx=U(1,2))},ot=i=>{i.status="locked",i.x=i.targetX,i.y=i.targetY,S(i.targetX,i.targetY,U(120,180),4,22,.85),w(i.targetX,i.targetY,8,14),I=mt(I+U(4.2,8.4),vt,te),c.onPsi?.(I),G+=1,G%2===0&&dt()},ft=i=>{let m=0,f=0,u=0;for(const s of l)if(s.active)if(u+=1,s.phase+=i*1.8,s.status==="exploded")s.x+=Math.cos(s.phase*.9)*6e-4,s.y+=Math.sin(s.phase*1.1)*6e-4;else if(s.status==="snapping"){m+=1,s.snapElapsed+=i;const B=mt(s.snapElapsed/s.snapDur,0,1),z=ee(B),et=s.snapFromX+(s.targetX-s.snapFromX)*z,P=s.snapFromY+(s.targetY-s.snapFromY)*z,R=s.targetX-s.snapFromX,W=s.targetY-s.snapFromY,at=Math.max(1e-5,Math.hypot(R,W)),ht=R/at,Mt=W/at,kt=pt(s.overshootPx)*ht,ye=ut(s.overshootPx)*Mt,Bt=Math.sin(Math.PI*B)*Math.exp(-4.8*B);s.x=et+kt*Bt,s.y=P+ye*Bt,B>=1&&ot(s)}else s.status==="locked"&&(f+=1);return{snappingCount:m,lockedCount:f,activeCount:u}},ct=i=>{if(!D.active)return;D.time+=i;const m=mt(D.time/D.duration,0,1);!D.emittedBurst&&m>.15&&(D.emittedBurst=!0,S(D.originX,D.originY,320,6,34,.55)),m>=1&&(D.active=!1)},K=i=>{if(I+=(vt-I)*.32*i,c.onPsi?.(I),j+=i,j>=tt&&(j=0,tt=U(Jt,Qt),Z()),x==="summon")A+=i,A>=N&&(x="assemble");else if(x==="assemble"){Y-=i,Y<=0&&b<C.length&&(V(C[b]),b+=1,Y=U(_t,Xt));const{snappingCount:m,lockedCount:f,activeCount:u}=ft(i);u>0&&f>=u&&m===0&&(x="hold",O=ke,Z())}else x==="hold"&&(O-=i,O<=0&&it());ct(i)},St=i=>{t.clearRect(0,0,o,d);const m=t.createLinearGradient(0,0,o,d);m.addColorStop(0,"rgba(5, 14, 28, 0.98)"),m.addColorStop(1,"rgba(4, 10, 24, 0.98)"),t.fillStyle=m,t.fillRect(0,0,o,d),h(),rt();for(const f of l)a(f);$(i),J(i),M()},Q=i=>{if(!_)return;T||(T=i,p=i);const m=Math.min((i-T)/1e3,.05);if(T=i,!(H.length>0||F.length>0||E.active||D.active)&&i-p<Pe){q=requestAnimationFrame(Q);return}p=i,K(m),St(m),q=requestAnimationFrame(Q)},nt=new ResizeObserver(()=>X());return nt.observe(r),X(),q=requestAnimationFrame(Q),()=>{_=!1,cancelAnimationFrame(q),nt.disconnect(),e.remove()}},qt=6,Te=.12,Ee=.06,Re=80,Tt=4e3,ae=8e3;function se(){const r=[],c=5+Math.floor(Math.random()*4);for(let e=0;e<c;e++)r.push({x:.12+Math.random()*.76,y:.12+Math.random()*.76});return r}const Ie=r=>{const c=document.createElement("canvas");c.className="field-odom-canvas",Object.assign(c.style,{position:"absolute",inset:"0",width:"100%",height:"100%"});const e=c.getContext("2d");if(!e)return()=>{};r.appendChild(c);let t=0,o=0,d=Math.min(window.devicePixelRatio||1,1.5),L=0,_=0,q=!0,T=se(),p={x:T[0].x,y:T[0].y,heading:0,targetIdx:1,trailX:[],trailY:[]},x=0,A=0,N=Tt+Math.random()*(ae-Tt);const O=()=>{t=r.clientWidth||1,o=r.clientHeight||1,d=Math.min(window.devicePixelRatio||1,1.5),c.width=Math.round(t*d),c.height=Math.round(o*d),e.setTransform(d,0,0,d,0,0)},Y=()=>{const b=t/qt,y=o/qt;e.strokeStyle="rgba(56, 189, 248, 0.12)",e.lineWidth=.5;for(let l=0;l<=qt;l++)e.beginPath(),e.moveTo(l*b,0),e.lineTo(l*b,o),e.stroke(),e.beginPath(),e.moveTo(0,l*y),e.lineTo(t,l*y),e.stroke();e.strokeStyle="rgba(56, 189, 248, 0.3)",e.lineWidth=1.2,e.beginPath(),e.moveTo(0,o/2),e.lineTo(t,o/2),e.stroke(),e.beginPath(),e.moveTo(t/2,0),e.lineTo(t/2,o),e.stroke()},tt=()=>{if(!(T.length<2)){e.strokeStyle="rgba(100, 217, 255, 0.35)",e.lineWidth=1.5,e.setLineDash([4,4]),e.beginPath(),e.moveTo(T[0].x*t,T[0].y*o);for(let b=1;b<T.length;b++)e.lineTo(T[b].x*t,T[b].y*o);e.stroke(),e.setLineDash([]),T.forEach((b,y)=>{e.beginPath(),e.arc(b.x*t,b.y*o,y===p.targetIdx?5:3,0,Math.PI*2),e.fillStyle=y===p.targetIdx?"rgba(100, 217, 255, 0.9)":"rgba(100, 217, 255, 0.4)",e.fill()})}},j=()=>{const b=p.x*t,y=p.y*o,l=Math.min(t,o);if(p.trailX.length>1){e.strokeStyle="rgba(56, 189, 248, 0.2)",e.lineWidth=1,e.beginPath(),e.moveTo(p.trailX[0],p.trailY[0]);for(let E=1;E<p.trailX.length;E++)e.lineTo(p.trailX[E],p.trailY[E]);e.stroke()}e.beginPath(),e.arc(b,y,Te*l,0,Math.PI*2),e.strokeStyle="rgba(167, 139, 250, 0.3)",e.lineWidth=1,e.stroke();const F=Ee*l*2,H=.35;e.fillStyle="rgba(56, 189, 248, 0.25)",e.beginPath(),e.moveTo(b,y),e.lineTo(b+Math.cos(p.heading-H)*F,y+Math.sin(p.heading-H)*F),e.lineTo(b+Math.cos(p.heading+H)*F,y+Math.sin(p.heading+H)*F),e.closePath(),e.fill(),e.beginPath(),e.arc(b,y,4,0,Math.PI*2),e.fillStyle="#64d9ff",e.shadowColor="#64d9ff",e.shadowBlur=8,e.fill(),e.shadowBlur=0},I=()=>{if(A<=0)return;const b=p.x*t,y=p.y*o,l=Math.min(t,o),F=A*l*.3;e.beginPath(),e.arc(b,y,F,0,Math.PI*2),e.strokeStyle=`rgba(167, 139, 250, ${A*.8})`,e.lineWidth=2,e.stroke()},G=b=>{if(!q)return;_||(_=b);const y=Math.min((b-_)/1e3,.05);if(_=b,p.targetIdx<T.length){const l=T[p.targetIdx],F=l.x-p.x,H=l.y-p.y,E=Math.sqrt(F*F+H*H);p.heading=Math.atan2(H,F);const D=.15;E<.02?(p.x=l.x,p.y=l.y,p.targetIdx++):(p.x+=F/E*D*y,p.y+=H/E*D*y)}else T=se(),p.targetIdx=0,p.trailX=[],p.trailY=[];if(p.trailX.push(p.x*t),p.trailY.push(p.y*o),p.trailX.length>Re&&(p.trailX.shift(),p.trailY.shift()),x+=y*1e3,x>N){x=0,N=Tt+Math.random()*(ae-Tt),A=1;for(let l=p.targetIdx;l<T.length;l++)T[l].x=Math.max(.1,Math.min(.9,T[l].x+(Math.random()-.5)*.1)),T[l].y=Math.max(.1,Math.min(.9,T[l].y+(Math.random()-.5)*.1))}A=Math.max(0,A-y*2),e.clearRect(0,0,t,o),Y(),tt(),j(),I(),L=requestAnimationFrame(G)},C=new ResizeObserver(()=>O());return C.observe(r),O(),L=requestAnimationFrame(G),()=>{q=!1,cancelAnimationFrame(L),C.disconnect(),c.remove()}},ne=1.5,bt=8,Et=9800,ie=15e3,Rt=1100,oe=2100,Ce=r=>Math.min(1,Math.max(0,r)),re=r=>{const c=Ce(r);return c*c*(3-2*c)},_e=r=>{const c=document.createElement("canvas");c.className="designer-glyphforge-canvas",Object.assign(c.style,{position:"absolute",inset:"0",width:"100%",height:"100%",pointerEvents:"none"});const e=c.getContext("2d");if(!e)return()=>{};r.appendChild(c);let t=1,o=1,d=Math.min(window.devicePixelRatio||1,ne),L=!0,_=0,q=0,T=Math.random()*100,p=0,x=Et+Math.random()*(ie-Et),A=[],N=[],O=[];const Y=[];let tt=0,j=Rt+Math.random()*(oe-Rt);const I=(X,S)=>X+Math.random()*(S-X),G=()=>{t=Math.max(1,r.clientWidth),o=Math.max(1,r.clientHeight),d=Math.min(window.devicePixelRatio||1,ne),c.width=Math.round(t*d),c.height=Math.round(o*d),e.setTransform(d,0,0,d,0,0)},C=X=>{const S=[];for(let w=0;w<bt;w+=1)X?.[w]?S.push({x:Math.min(t*.9,Math.max(t*.1,X[w].x+I(-28,28))),y:Math.min(o*.9,Math.max(o*.1,X[w].y+I(-22,22)))}):S.push({x:I(t*.14,t*.86),y:I(o*.14,o*.86)});return S},b=()=>{const X=[];for(let S=0;S<bt-1;S+=1)X.push({a:S,b:S+1,width:I(1.05,2.1),speed:I(.072,.16),phase:Math.random()});for(let S=0;S<5;S+=1){const w=Math.floor(Math.random()*bt);let Z=Math.floor(Math.random()*bt);w===Z&&(Z=(Z+2)%bt),X.push({a:w,b:Z,width:I(.8,1.5),speed:I(.055,.13),phase:Math.random()})}return X},y=(X,S)=>{const w=A[X],Z=N[X];if(!w||!Z)return{x:t*.5,y:o*.5};const dt=re(S);return{x:w.x+(Z.x-w.x)*dt,y:w.y+(Z.y-w.y)*dt}},l=()=>{e.strokeStyle="rgba(96, 165, 250, 0.11)",e.lineWidth=1;for(let S=.5;S<t;S+=14)e.beginPath(),e.moveTo(S,0),e.lineTo(S,o),e.stroke();for(let S=.5;S<o;S+=14)e.beginPath(),e.moveTo(0,S),e.lineTo(t,S),e.stroke()},F=X=>{for(const S of O){const w=y(S.a,X),Z=y(S.b,X);e.strokeStyle="rgba(125, 211, 252, 0.2)",e.lineWidth=S.width,e.beginPath(),e.moveTo(w.x,w.y),e.lineTo(Z.x,Z.y),e.stroke();const dt=(T*S.speed+S.phase)%1,n=re(dt),g=w.x+(Z.x-w.x)*n,v=w.y+(Z.y-w.y)*n;e.strokeStyle="rgba(244, 114, 182, 0.82)",e.lineWidth=Math.max(.9,S.width-.25),e.beginPath(),e.moveTo(w.x,w.y),e.lineTo(g,v),e.stroke(),e.fillStyle="rgba(244, 114, 182, 0.9)",e.beginPath(),e.arc(g,v,1.8,0,Math.PI*2),e.fill()}},H=X=>{for(let S=0;S<bt;S+=1){const w=y(S,X);e.fillStyle="rgba(125, 211, 252, 0.82)",e.beginPath(),e.arc(w.x,w.y,1.65,0,Math.PI*2),e.fill()}},E=X=>{const S=Math.floor(Math.random()*bt),w=y(S,X);Y.push({x:w.x,y:w.y,r:I(4,10),alpha:I(.35,.65),growth:I(18,34)})},D=X=>{for(let S=Y.length-1;S>=0;S-=1){const w=Y[S];if(w.r+=w.growth*X,w.alpha-=X*.55,w.alpha<=0){Y.splice(S,1);continue}e.strokeStyle=`rgba(34, 211, 238, ${w.alpha})`,e.lineWidth=1.2,e.beginPath(),e.arc(w.x,w.y,w.r,0,Math.PI*2),e.stroke()}},gt=X=>{if(!L)return;q||(q=X);const S=Math.min((X-q)/1e3,.05);q=X,T+=S,p+=S*1e3;let w=p/x;for(w>=1&&(A=N,N=C(A),p=0,x=Et+Math.random()*(ie-Et),w=0),e.fillStyle="rgba(4, 8, 20, 0.2)",e.fillRect(0,0,t,o),l(),F(w),H(w),tt+=S*1e3,tt>=j&&(tt=0,j=Rt+Math.random()*(oe-Rt),E(w)),D(S);Y.length>24;)Y.shift();_=requestAnimationFrame(gt)},pt=()=>{G(),A=C(),N=C(A),O=b()},ut=new ResizeObserver(()=>pt());return ut.observe(r),pt(),_=requestAnimationFrame(gt),()=>{L=!1,cancelAnimationFrame(_),ut.disconnect(),c.remove()}},Xe=(r,c={})=>{const e=c.interval??36,t=c.lineDelay??320,o=r.map(x=>x.dataset.text??x.textContent??"");o.forEach((x,A)=>{r[A].dataset.text=x});let d=[],L=!1;const _=()=>{d.forEach(x=>window.clearTimeout(x)),d=[]},q=()=>{_(),r.forEach(x=>{x.textContent=""})};return{play:()=>{q(),L=!0;let x=0;r.forEach((A,N)=>{const O=o[N],Y=x;d.push(window.setTimeout(()=>{L&&c.onLineStart?.(A,N)},Y));for(let j=0;j<O.length;j+=1){const I=Y+j*e;d.push(window.setTimeout(()=>{L&&(A.textContent+=O[j],c.onCharacter?.(A,N,O[j]))},I))}const tt=Y+O.length*e;d.push(window.setTimeout(()=>{L&&c.onLineComplete?.(A,N)},tt)),x+=O.length*e+t})},stop:()=>{L=!1,_(),c.preserveOnStop||r.forEach(x=>{x.textContent=""})},reset:q}},le=["rgba(20, 37, 76, 0.96)","rgba(41, 24, 87, 0.9)","rgba(10, 17, 35, 0.95)","rgba(76, 49, 18, 0.78)"],ce=420,he=1150,de=3600,fe=7600,Ne=980,me=1.5,k=(r,c)=>r+Math.random()*(c-r),It=r=>Math.max(0,Math.min(1,r)),yt=r=>{const c=It(r);return c*c*(3-2*c)},ge=17,pe=10,Ye=r=>r-Math.floor(r),lt=r=>Ye(Math.sin(r*12.9898)*43758.5453),xt=(r,c,e)=>r+(c-r)*e,Ot=r=>{const c=[];for(let e=0;e<ge;e+=1){const t=e/(ge-1),o=1-Math.abs(t-.5)*1.65,d=yt((t-.62)/.38),L=lt(r+e*.73)-.5,_=lt(r*1.3+e*1.91)-.5,q=Math.sin((t*3.1+r*.07)*Math.PI*2)*.08,T=d*(lt(r*2.1+e*.53)-.5)*.34,p=.58+o*.55+L*.4+_*.22+q+T;c.push(Math.max(.26,Math.min(1.7,p)))}return c},Dt=r=>{const c=[],e=2+Math.floor(lt(r*.37)*4),t=1+Math.floor(lt(r*.73)*3),o=Array.from({length:e},(L,_)=>lt(r+_*1.67)),d=Array.from({length:t},(L,_)=>lt(r*1.31+_*2.11));for(let L=0;L<pe;L+=1){const _=L/pe,q=lt(r+L*.91)-.5,T=lt(r*1.7+L*1.33)-.5;let p=.58+q*.85+T*.45;for(let x=0;x<o.length;x+=1){const A=o[x]??.5,N=Math.min(Math.abs(_-A),1-Math.abs(_-A)),O=.55+lt(r*2.4+x*.53)*.95,Y=.08+lt(r*3.9+x*.81)*.15;p+=O*Math.exp(-(N*N)/(Y*Y))}for(let x=0;x<d.length;x+=1){const A=d[x]??.5,N=Math.min(Math.abs(_-A),1-Math.abs(_-A)),O=.35+lt(r*4.6+x*.77)*.7,Y=.06+lt(r*5.7+x*.44)*.12;p-=O*Math.exp(-(N*N)/(Y*Y))}c.push(Math.max(.08,Math.min(2.7,p)))}return c},wt=(r,c)=>{const e=Math.max(0,Math.min(.9999,c))*(r.length-1),t=Math.floor(e),o=Math.min(r.length-1,t+1),d=e-t;return xt(r[t]??1,r[o]??1,d)},qe=()=>{const r=Math.random();return r<.52?k(2.1,4.2):r<.88?k(5,9.2):k(10.5,17.8)},Oe=(r,c={})=>{const e=document.createElement("canvas");e.className="inkdrips-canvas",Object.assign(e.style,{position:"absolute",inset:"0",width:"100%",height:"100%",pointerEvents:"none"});const t=e.getContext("2d");if(!t)return()=>{};r.appendChild(e);let o=1,d=1,L=Math.min(window.devicePixelRatio||1,me),_=0,q=0,T=!0;const p=[],x=[],A=[],N=[],O=[];let Y=0,tt=k(ce,he),j=0,I=0,G=0,C=0,b=0,y=k(de,fe),l=null;const F=c.palette?.length?c.palette:le,H=()=>{o=Math.max(1,r.clientWidth),d=Math.max(1,r.clientHeight),L=Math.min(window.devicePixelRatio||1,me),e.width=Math.round(o*L),e.height=Math.round(d*L),t.setTransform(L,0,0,L,0,0)},E=()=>{const n=k(55,160);p.push({x:k(0,o),y:k(0,d),z:n,vz:k(50,130),startZ:n,radius:qe(),alpha:k(.7,.96),color:F[Math.floor(Math.random()*F.length)]??le[0]})},D=n=>{const g=Math.random()*1e3;O.push({x:n.x,y:n.y,radius:n.radius*k(1.45,2.6),alpha:k(.58,.9),age:0,lifetime:k(3.6,7.6),seed:Math.random()*Math.PI*2,shapeSeed:g,morph:Math.random(),morphVel:k(.08,.2),skewX:k(-.18,.18),skewY:k(-.14,.14),targetSkewX:k(-.24,.24),targetSkewY:k(-.2,.2),skewLerp:Math.random(),skewLerpVel:k(.08,.2),profileA:Ot(g),profileB:Ot(g+19.31),color:n.color}),A.push({x:n.x,y:n.y,rx:n.radius*k(1.18,2.4),ry:n.radius*k(.62,1.4),alpha:k(.66,.96)}),N.push({x:n.x,y:n.y,r:n.radius*k(.68,1.45),alpha:k(.38,.66),growth:k(14,30)});const v=6+Math.floor(n.radius*1.3)+Math.floor(Math.random()*8);for(let a=0;a<v;a+=1){const h=Math.random()*1e3,M=k(0,Math.PI*2),$=k(4,20)*(.7+n.radius*.024);x.push({originX:n.x,originY:n.y,x:n.x,y:n.y,vx:Math.cos(M)*$,vy:Math.sin(M)*$*k(.58,.96),radius:k(1.4,5.4)*(.9+n.radius*.075),alpha:k(.54,.9),age:0,life:k(4.2,7.5),rot:k(0,Math.PI*2),spin:k(-1.2,1.2),seed:h,morph:Math.random(),morphVel:k(.16,.4),biasX:k(-.3,.3),biasY:k(-.25,.25),targetBiasX:k(-.35,.35),targetBiasY:k(-.3,.3),biasLerp:Math.random(),biasLerpVel:k(.14,.32),profileA:Dt(h),profileB:Dt(h+13.7)})}},gt=n=>{const g=It(n.age/n.lifetime),v=g<.72?1:1-yt((g-.72)/.28),a=yt(Math.min(1,g*1.2)),h=1+.09*Math.sin((g*6+n.seed)*Math.PI*2)+.05*Math.sin((g*11+n.seed*.7)*Math.PI*2),M=n.radius*(.72+a*1.24)*h,$=M*(.76+.12*Math.sin(n.seed*1.31)),J=yt(n.morph),rt=yt(n.skewLerp),it=xt(n.skewX,n.targetSkewX,rt),V=xt(n.skewY,n.targetSkewY,rt),ot=M*.32,ft=M*.12,ct=M*.03,K=40;t.beginPath();for(let Q=0;Q<=K;Q+=1){const nt=Q/K,i=-Math.PI/2+nt*Math.PI,m=wt(n.profileA,nt),f=wt(n.profileB,nt),u=xt(m,f,J),s=.08*Math.sin((nt*9+n.seed*.4+n.age*1.35)*Math.PI*2)+.05*Math.sin((nt*15+n.seed*.9+n.age*2.1)*Math.PI*2),B=Math.max(.2,u+s),z=M*B*Math.cos(i),et=$*(.82+B*.28)*Math.sin(i),P=it*M*Math.sin(i*2+n.seed*.8),R=V*$*Math.cos(i*3+n.seed*1.1),W=n.x+z+ot+P,at=n.y+et+ft+ct+R;Q===0?t.moveTo(W,at):t.lineTo(W,at)}for(let Q=K;Q>=0;Q-=1){const nt=Q/K,i=-Math.PI/2+nt*Math.PI,m=wt(n.profileA,nt),f=wt(n.profileB,nt),u=xt(m,f,J),s=.08*Math.sin((nt*9+n.seed*.4+n.age*1.35)*Math.PI*2)+.05*Math.sin((nt*15+n.seed*.9+n.age*2.1)*Math.PI*2),B=Math.max(.2,u+s),z=M*B*Math.cos(i),et=$*(.82+B*.28)*Math.sin(i),P=it*M*Math.sin(i*2+n.seed*.8),R=V*$*Math.cos(i*3+n.seed*1.1),W=n.x-z-ot-P,at=n.y+et+ft+ct+R;t.lineTo(W,at)}t.closePath();const St=n.alpha*v;t.fillStyle=n.color.replace(/[\d.]+\)$/,`${Math.max(.15,St)})`),t.fill(),t.beginPath(),t.ellipse(n.x,n.y+M*.03,M*(.28+.12*Math.sin(g*8+n.seed)),$*(.2+.09*Math.cos(g*6+n.seed*.7)),0,0,Math.PI*2),t.fillStyle=`rgba(10, 16, 40, ${.22*v})`,t.fill()},pt=n=>{const g=It(n.age/n.life),v=g<.58?1:1-yt((g-.58)/.42),a=yt(n.morph),h=yt(n.biasLerp),M=xt(n.biasX,n.targetBiasX,h),$=xt(n.biasY,n.targetBiasY,h),J=20,rt=.62+.52*(.5+.5*Math.sin(n.seed*.7+n.age*2.45));t.save(),t.translate(n.x,n.y),t.rotate(n.rot),t.beginPath();for(let it=0;it<=J;it+=1){const V=it/J,ot=V*Math.PI*2,ft=wt(n.profileA,V),ct=wt(n.profileB,V),K=xt(ft,ct,a),St=.18*Math.sin((V*8+n.seed*.4+n.age*2.9)*Math.PI*2)+.11*Math.sin((V*14+n.seed*.8+n.age*4.1)*Math.PI*2),Q=n.radius*Math.max(.06,K+St),nt=1+M*Math.cos(ot*2.2+n.seed*.43),i=1+$*Math.sin(ot*2.8+n.seed*.67),m=Math.cos(ot)*Q*nt,f=Math.sin(ot)*Q*rt*i;it===0?t.moveTo(m,f):t.lineTo(m,f)}t.closePath(),t.fillStyle=`rgba(34, 55, 118, ${Math.min(1,n.alpha*v*1.25)})`,t.fill(),t.beginPath(),t.ellipse(0,0,n.radius*.3,n.radius*.2,0,0,Math.PI*2),t.fillStyle=`rgba(16, 28, 76, ${.24*v})`,t.fill(),t.restore()},ut=()=>{t.fillStyle="rgba(2, 7, 18, 0.38)",t.fillRect(0,0,o,d);const n=t.createLinearGradient(0,0,0,d);n.addColorStop(0,"rgba(70, 118, 210, 0.07)"),n.addColorStop(.52,"rgba(14, 40, 94, 0.03)"),n.addColorStop(1,"rgba(0, 6, 15, 0.15)"),t.fillStyle=n,t.fillRect(0,0,o,d);const g=t.createRadialGradient(o*.38,d*.28,Math.min(o,d)*.06,o*.52,d*.56,Math.max(o,d)*.95);g.addColorStop(0,"rgba(92, 160, 255, 0.16)"),g.addColorStop(1,"rgba(2, 7, 18, 0)"),t.fillStyle=g,t.fillRect(0,0,o,d);const v=t.createRadialGradient(o*.5,d*.5,Math.min(o,d)*.14,o*.5,d*.5,Math.max(o,d)*.82);v.addColorStop(0,"rgba(0, 0, 0, 0)"),v.addColorStop(1,"rgba(0, 0, 0, 0.56)"),t.fillStyle=v,t.fillRect(0,0,o,d)},X=()=>{t.strokeStyle="rgba(210, 190, 155, 0.065)",t.lineWidth=.62;const n=13;for(let g=-n+I;g<d+n;g+=n)t.beginPath(),t.moveTo(0,g),t.lineTo(o,g),t.stroke()},S=()=>{t.fillStyle="rgba(210, 236, 255, 0.05)";for(let g=j;g<d;g+=3)t.fillRect(0,g,o,1);const n=t.createLinearGradient(0,G-40,0,G+40);n.addColorStop(0,"rgba(120, 220, 255, 0)"),n.addColorStop(.5,"rgba(120, 220, 255, 0.22)"),n.addColorStop(1,"rgba(120, 220, 255, 0)"),t.fillStyle=n,t.fillRect(0,G-40,o,80)},w=()=>{if(C<=0||!l)return;t.save(),t.translate(l.x,l.y),t.rotate(l.rot),t.font=`bold ${Math.max(10,Math.round(o/18))}px "Press Start 2P", monospace`,t.textAlign="center",t.textBaseline="middle",t.strokeStyle=`rgba(220, 38, 38, ${C*.72})`,t.lineWidth=2,t.strokeText(l.label,0,0),t.fillStyle=`rgba(220, 38, 38, ${C*.28})`,t.fillText(l.label,0,0);const n=t.measureText(l.label).width;t.strokeRect(-n/2-8,-10,n+16,20),t.restore()},Z=n=>{if(!T)return;q||(q=n);const g=Math.min((n-q)/1e3,.05);if(q=n,t.clearRect(0,0,o,d),ut(),I=(I+g*8)%14,j=(j+g*35)%3,G=(G+g*68)%(d+90),Y+=g*1e3,Y>=tt&&(Y=0,tt=k(ce,he),E()),b+=g*1e3,b>=y){b=0,y=k(de,fe),C=1;const v=["PASS","INSPECTED","APPROVED","VERIFIED"];l={label:v[Math.floor(Math.random()*v.length)]??"PASS",x:k(o*.2,o*.8),y:k(d*.22,d*.78),rot:k(-.25,.25)}}C=Math.max(0,C-g*2.6),C<=0&&(l=null),X();for(let v=O.length-1;v>=0;v-=1){const a=O[v];if(a.age+=g,a.morph+=g*a.morphVel,a.skewLerp+=g*a.skewLerpVel,a.morph>=1&&(a.morph-=1,a.shapeSeed+=k(.7,2.2),a.profileA=a.profileB,a.profileB=Ot(a.shapeSeed+a.age*3.1)),a.skewLerp>=1&&(a.skewLerp-=1,a.skewX=a.targetSkewX,a.skewY=a.targetSkewY,a.targetSkewX=k(-.24,.24),a.targetSkewY=k(-.2,.2)),a.age>=a.lifetime){O.splice(v,1);continue}gt(a)}for(let v=A.length-1;v>=0;v-=1){const a=A[v];if(a.alpha-=g*.036,a.rx+=g*.85,a.ry+=g*.42,a.alpha<=0){A.splice(v,1);continue}t.beginPath(),t.ellipse(a.x,a.y,a.rx,a.ry,0,0,Math.PI*2),t.fillStyle=`rgba(22, 38, 96, ${Math.min(1,a.alpha*1.1)})`,t.fill()}for(let v=N.length-1;v>=0;v-=1){const a=N[v];if(a.r+=a.growth*g,a.alpha-=g*.24,a.alpha<=0){N.splice(v,1);continue}t.beginPath(),t.ellipse(a.x,a.y,a.r,a.r*.64,0,0,Math.PI*2),t.strokeStyle=`rgba(118, 176, 255, ${a.alpha})`,t.lineWidth=1.15,t.stroke()}for(let v=x.length-1;v>=0;v-=1){const a=x[v],h=(a.originX-a.x)*2.8*g,M=(a.originY-a.y)*2.8*g;a.vx+=h,a.vy+=M;const $=Math.exp(-5.6*g);if(a.vx*=$,a.vy*=$,a.x+=a.vx*g,a.y+=a.vy*g,a.alpha-=g*.035,a.radius*=.99955,a.age+=g,a.rot+=a.spin*g,a.morph+=g*a.morphVel,a.biasLerp+=g*a.biasLerpVel,a.morph>=1&&(a.morph-=1,a.seed+=k(2.4,5.8),a.profileA=a.profileB,a.profileB=Dt(a.seed+a.age*5.1)),a.biasLerp>=1&&(a.biasLerp-=1,a.biasX=a.targetBiasX,a.biasY=a.targetBiasY,a.targetBiasX=k(-.35,.35),a.targetBiasY=k(-.3,.3)),a.alpha<=0||a.radius<.4||a.age>=a.life){x.splice(v,1);continue}pt(a)}for(let v=p.length-1;v>=0;v-=1){const a=p[v];if(a.vz+=Ne*g,a.z-=a.vz*g,a.z<=0){D(a),p.splice(v,1);continue}const h=1-It(a.z/a.startZ);t.beginPath(),t.ellipse(a.x,a.y,a.radius*(1.03+h*.62),a.radius*(.48+h*.34),0,0,Math.PI*2),t.fillStyle=`rgba(8, 14, 28, ${.08+h*.23})`,t.fill();const M=.28+h*.96;t.beginPath(),t.arc(a.x,a.y,a.radius*M,0,Math.PI*2),t.fillStyle=a.color.replace(/[\d.]+\)$/,`${Math.max(.24,a.alpha*(.54+h*.46))})`),t.fill()}for(S(),w();p.length>36;)p.shift();for(;x.length>520;)x.shift();for(;A.length>180;)A.shift();for(;N.length>84;)N.shift();for(;O.length>42;)O.shift();_=requestAnimationFrame(Z)},dt=new ResizeObserver(()=>H());return dt.observe(r),H(),_=requestAnimationFrame(Z),()=>{T=!1,cancelAnimationFrame(_),dt.disconnect(),e.remove()}},De=48,Fe=420,ue=["⦿","✶","∴","☉","✧","✦","✨"],Me=["RUNE SURGE","ARCANA PROC","AETHER BURST","GLYPH CASCADE"];let Ft=!1,Ct=null,Pt=null;const st=()=>typeof window<"u"&&typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion: reduce)").matches,Be=()=>{Ct&&(Ct(),Ct=null),Ft=!1},We=()=>{if(Ft)return;Ft=!0;const r=document.querySelectorAll(".role-back[data-role]"),c=[];r.forEach(e=>{try{if(e.dataset.enhanced==="1")return;e.dataset.enhanced="1";const t=e.getAttribute("data-role");if(!t)return;const o=e.closest(".tile");if(!o)return;const d=new Map;let L,_,q,T,p=!1,x=0,A,N=!1,O=!1,Y=!1,tt=!1,j=!1;const I=new Set,G=new Set;let C=0;const b=()=>{I.forEach(a=>window.clearTimeout(a)),G.forEach(a=>window.clearInterval(a)),I.clear(),G.clear()},y=(a,h)=>{const M=window.setTimeout(()=>{I.delete(M),a()},h);return I.add(M),M},l=(a,h,M=600)=>{a&&(a.classList.add(h),y(()=>a.classList.remove(h),M))},F=(a,h=0)=>a+Math.random()*h,H=()=>{const a=e.querySelector("[data-arcana-sigil]");a&&(a.textContent=ue[Math.floor(Math.random()*ue.length)]??"⦿");const h=e.querySelector(".arcana-proc");h&&(h.textContent=Me[Math.floor(Math.random()*Me.length)]??"ARCANA PROC"),e.style.setProperty("--fx-seed-a",(.75+Math.random()*1.6).toFixed(3)),e.style.setProperty("--fx-seed-b",(.2+Math.random()*.9).toFixed(3)),e.querySelectorAll(".notebook-rune").forEach((M,$)=>{M.style.setProperty("--delay",`${(Math.random()*1.4+$*.08).toFixed(2)}s`),M.style.setProperty("--x",`${Math.round(8+Math.random()*84)}%`),M.style.setProperty("--travel",`${Math.round(40+Math.random()*35)}%`)}),e.querySelectorAll(".designer-constraints span").forEach(M=>{M.style.opacity=(.62+Math.random()*.3).toFixed(2),M.style.transform=`translate(${(-3+Math.random()*6).toFixed(1)}px, ${(-2+Math.random()*4).toFixed(1)}px)`})},E=a=>{for(const h of a)h.style.animation="none",h.offsetWidth,h.style.animation=""},D=(a,h={})=>{if(!d.has(a)){const $=e.querySelector(`[data-typewriter="${a}"]`);if(!$)return null;const J=Array.from($.querySelectorAll("[data-line]"));if(!J.length)return null;d.set(a,{controller:Xe(J,h),lines:J})}const M=d.get(a);return M?(M.controller.stop(),M.controller.reset(),M.lines.forEach($=>{$.classList.remove("is-visible","is-finished","is-glow","is-impact","is-muted","is-final-line")}),M):null},gt=()=>{if(st()||A)return;const a=e.querySelector("[data-inkblot]");a&&(A=Oe(a))},pt=a=>{const h=Math.max(0,Math.round(a)),M=e.querySelector('[data-telemetry-value="air-psi"]');M&&(M.textContent=String(h));const $=e.querySelector('[data-telemetry-value="tension"]');$&&($.textContent=h>=94?"OK":h>=88?"WARN":"LOW")},ut=()=>{if(!p){if(p=!0,t==="coder"){const a=e.querySelector("[data-matrix]"),h=e.querySelector(".coder-scene"),M=e.querySelector(".coder-terminal"),$=e.querySelector(".coder-cube"),J=e.querySelector("[data-coder-boot]"),rt=e.querySelector(".coder-matrix");!st()&&a&&a.clientWidth>10&&requestAnimationFrame(()=>{L=we(a)});const it=()=>l($,"is-active",1200),V=()=>l(rt,"is-glitching",900),ot=()=>l(M,"is-nudge",520),ft=D("coder",{interval:st()?0:32,lineDelay:st()?0:400,onLineStart:K=>K.classList.add("is-visible"),onLineComplete:K=>{K.classList.add("is-finished"),K.dataset.cube==="1"&&it(),K.dataset.glitch==="1"&&V(),K.dataset.nudge==="1"&&ot()}});tt||(tt=!0,l(h,"is-blackout",200),l(h,"is-crt",900),l(h,"is-booting",1200),l(M,"is-sliding",1100),J&&(J.textContent=`[ SIGMA_MATRIX ONLINE ]
[ ACCESS LEVEL: ROOT // VRC_2025_26 ]`,l(J,"is-visible",1100),y(()=>J.textContent="",1200)));const ct=()=>{l(rt,"is-storm",1200),y(ct,F(6e3,2200))};st()||ct(),ft?.controller.play()}else if(t==="driver"){const a=e.querySelector("[data-driver]");!st()&&a&&a.clientWidth>10&&requestAnimationFrame(()=>{q=Ie(a)}),N||(N=!0),D("driver",{interval:st()?0:30,lineDelay:st()?0:340,onLineStart:M=>M.classList.add("is-visible"),onLineComplete:M=>{M.classList.add("is-finished")}})?.controller.play()}else if(t==="builder"){const a=e.querySelector("[data-builder]");!st()&&a&&a.clientWidth>10&&requestAnimationFrame(()=>{_=Le(a,{onPsi:pt})}),pt(100),O||(O=!0),D("builder",{interval:st()?0:34,lineDelay:st()?0:330,onLineStart:M=>M.classList.add("is-visible"),onLineComplete:M=>{M.classList.add("is-finished")}})?.controller.play()}else if(t==="notebooker"){const a=e.querySelector(".notebook-scroll__paper"),h=Array.from(e.querySelectorAll(".notebook-scroll__cap")),M=e.querySelector(".notebook-runes"),$=e.querySelector(".notebook-terminal"),J=e.querySelector(".notebook-ghostpage"),rt=e.querySelector(".notebook-judge"),it=e.querySelector(".notebook-timeline");let V=[];Y||(Y=!0,l(a,"is-entrance",1100),l(M,"is-ring",1100));const ot=D("notebook",{interval:st()?0:De,lineDelay:st()?0:Fe,onLineStart:K=>K.classList.add("is-visible"),onLineComplete:K=>{K.classList.add("is-finished"),V.indexOf(K)===0&&h.forEach(Q=>l(Q,"is-contract",600)),K.dataset.glow==="1"&&(K.classList.add("is-glow"),l(M,"is-surging",900)),K.dataset.final==="1"&&(K.classList.add("is-final-line"),$?.classList.add("is-final"),V.forEach(Q=>{Q!==K&&Q.classList.add("is-muted")}),l(it,"is-tracing",1500))}});V=ot?.lines??[],ot?.controller.play(),gt();const ft=()=>{l(J,"is-active",1400),y(ft,F(9500,2400))},ct=()=>{l(rt,"is-active",1200),y(ct,F(15e3,4200))};ft(),ct()}else if(t==="designer"){const a=e.querySelector("[data-designer]"),h=e.querySelector(".designer-blueprint"),M=e.querySelectorAll(".designer-constraints span"),$=e.querySelector(".designer-terminal"),J=e.querySelector(".designer-progress"),rt=e.querySelector(".designer-toast");!st()&&a&&a.clientWidth>10&&requestAnimationFrame(()=>{T=_e(a)}),j||(j=!0,l(h,"is-booting",1200),M.forEach(V=>l(V,"is-drop",900))),D("designer",{interval:st()?0:30,lineDelay:st()?0:340,onLineStart:V=>V.classList.add("is-visible"),onLineComplete:V=>{V.classList.add("is-finished"),V.dataset.blueprintGlow==="1"&&l(h,"is-validated",1100),V.dataset.blueprintAura==="1"&&l(h,"is-aura",1100),V.dataset.blueprintProgress==="1"&&l(J,"is-active",1500),V.dataset.blueprintTilt==="1"&&(l(h,"is-tilt",1400),l(rt,"is-visible",1200))}})?.controller.play(),E(e.querySelectorAll("[data-blueprint-line]")),E(e.querySelectorAll(".designer-constraints span"))}}},X=()=>{if(!p)return;p=!1,window.clearTimeout(x),x=0,b(),e.classList.remove("is-scroll-ready","is-prophecy-final","is-revealing","is-glitch-tear","is-crt-boot","is-warp-snap","is-blueprint-draw","is-spark-burst","is-prophecy-glow","is-glitch-spike","is-speedline-surge","is-measure-ping"),N=!1,O=!1,Y=!1,tt=!1,j=!1,e.querySelectorAll(".driver-scene, .driver-viewport").forEach(h=>h.classList.remove("is-entering","is-waking","is-boosting","is-warping","is-camera-snap","is-photo")),e.querySelectorAll(".builder-scene").forEach(h=>h.classList.remove("is-booting","is-bpm","is-stomp","is-assembling","is-boost","is-wake","is-quake")),e.querySelectorAll(".notebook-scroll__paper, .notebook-runes, .notebook-ghostpage, .notebook-judge").forEach(h=>h.classList.remove("is-entrance","is-ring","is-surging","is-active","is-tracing")),e.querySelector(".notebook-terminal")?.classList.remove("is-final"),e.querySelector(".notebook-timeline")?.classList.remove("is-tracing"),e.querySelectorAll(".designer-blueprint, .designer-progress, .designer-toast").forEach(h=>h.classList.remove("is-booting","is-validated","is-aura","is-tilt","is-visible","is-active")),e.querySelector(".coder-terminal")?.classList.remove("is-sliding","is-nudge"),e.querySelector(".coder-cube")?.classList.remove("is-active"),e.querySelector(".coder-scene")?.classList.remove("is-blackout","is-crt","is-booting"),e.querySelector(".coder-matrix")?.classList.remove("is-rain-burst","is-storm");const a=e.querySelector("[data-coder-boot]");a&&(a.textContent=""),e.querySelectorAll(".role-back__shockwave").forEach(h=>h.remove()),L?.(),L=void 0,_?.(),_=void 0,q?.(),q=void 0,T?.(),T=void 0,A?.(),A=void 0,d.forEach(h=>{h.controller.stop(),h.lines.forEach(M=>{M.textContent="",M.classList.remove("is-visible","is-finished","is-glow","is-impact","is-muted","is-final-line")})})},S={coder:()=>{l(e,"is-glitch-spike",400);const a=e.querySelector(".coder-matrix");a&&l(a,"is-rain-burst",500)},driver:()=>{l(e,"is-speedline-surge",500)},designer:()=>{l(e,"is-measure-ping",400)},builder:()=>{l(e,"is-spark-burst",500)},notebooker:()=>{l(e,"is-prophecy-glow",600);const a=e.querySelector(".role-viewport");if(!a)return;const h=document.createElement("span");h.className="role-back__shockwave",a.appendChild(h),y(()=>h.remove(),700)}},w=()=>{if(!t||st())return;const a=S[t];if(!a)return;const h=()=>{if(!p)return;a();const M=3e3+Math.random()*5e3;C=y(h,M)};C=y(h,3e3+Math.random()*2e3)},Z=()=>{C&&(window.clearTimeout(C),C=0)},dt=()=>{st()||(e.classList.remove("is-revealing","is-glitch-tear"),e.offsetWidth,e.classList.add("is-revealing"),t==="coder"?(e.classList.add("is-crt-boot"),y(()=>e.classList.remove("is-crt-boot"),600)):t==="driver"?(e.classList.add("is-warp-snap"),y(()=>e.classList.remove("is-warp-snap"),600)):t==="designer"?(e.classList.add("is-blueprint-draw"),y(()=>e.classList.remove("is-blueprint-draw"),1350)):t==="builder"?(e.classList.add("is-spark-burst"),y(()=>e.classList.remove("is-spark-burst"),500)):t==="notebooker"&&(e.classList.add("is-prophecy-glow"),y(()=>e.classList.remove("is-prophecy-glow"),600)),y(()=>{e.classList.add("is-glitch-tear"),y(()=>e.classList.remove("is-glitch-tear"),300)},100),y(()=>e.classList.remove("is-revealing"),500))},n=a=>{e.classList.toggle("is-active",a),a?(H(),Pt&&Pt(),Pt=()=>{Z(),X()},dt(),ut(),window.clearTimeout(x),x=y(()=>{p&&(e.classList.add("is-scroll-ready"),t==="notebooker"&&gt())},420),y(()=>w(),1500)):(Pt&&(Pt(),Pt=null),Z(),X())},g=a=>{const h=a.detail;n(!!h?.flipped)};o.addEventListener("tile:flipped",g),c.push(()=>o.removeEventListener("tile:flipped",g)),n(o.classList.contains("is-flipped"));const v=()=>{if(p){if(document.hidden)b(),d.forEach(a=>a.controller.stop());else if(d.forEach(a=>a.controller.play()),t==="driver"){const a=e.querySelector(".driver-viewport"),h=()=>{l(a,"is-boosting",1200),y(h,F(5200,1800))};h()}else if(t==="notebooker"){const a=e.querySelector(".notebook-ghostpage"),h=()=>{l(a,"is-active",1400),y(h,F(9500,2400))};h()}}};document.addEventListener("visibilitychange",v),c.push(()=>{document.removeEventListener("visibilitychange",v),X()})}catch(t){console.error("Error initializing role back for",e.dataset.role,t)}}),Ct=()=>{c.forEach(e=>e())}};export{Be as cleanupRoleBacks,We as initRoleBacks};
